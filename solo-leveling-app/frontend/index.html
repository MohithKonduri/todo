<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System Interface</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700;900&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root { --glow-blue: #00aaff; --glow-red: #ff0033; --glow-gold: #FFD700; --glow-purple: #9d00ff; --glow-green: #00ff6a; }
        html { scroll-behavior: smooth; }
        body { font-family: 'Inter', sans-serif; background-color: #0A0A0F; color: #E0E0E0; position: relative; } 
        .font-orbitron { font-family: 'Orbitron', sans-serif; }
        
        /* Smoky blue aura effect */
        .animated-bg {
            background-color: #0A0A0F; /* The deep dark blue base */
        }

        /* --- Crackling Thunder Effect --- */

        .animated-bg.thunder-active::before {
          content: '';
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: radial-gradient(circle at 50% 50%, rgba(255, 255, 255, 0.4) 0%, transparent 50%);
          opacity: 0;
          pointer-events: none;
          z-index: 0;
          animation: thunder-crackle 2s infinite;
        }

        .animated-bg.thunder-active::after {
          content: '';
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: radial-gradient(circle at 30% 70%, rgba(255, 255, 255, 0.3) 0%, transparent 40%),
                      radial-gradient(circle at 70% 30%, rgba(0, 170, 255, 0.3) 0%, transparent 35%);
          opacity: 0;
          pointer-events: none;
          z-index: 0;
          animation: thunder-flash 2s infinite;
        }

        @keyframes thunder-crackle {
          0%, 90%, 100% { opacity: 0; }
          91% { opacity: 0.8; }
          92% { opacity: 0.4; }
          93% { opacity: 0.8; }
          94% { opacity: 0.2; }
          95% { opacity: 0.6; }
          96% { opacity: 0.3; }
          97% { opacity: 0.7; }
          98% { opacity: 0.1; }
          99% { opacity: 0.5; }
        }

        @keyframes thunder-flash {
          0%, 85%, 100% { opacity: 0; }
          86% { opacity: 0.7; }
          87% { opacity: 0.3; }
          88% { opacity: 0.8; }
          89% { opacity: 0.4; }
          90% { opacity: 0.6; }
          91% { opacity: 0.2; }
          92% { opacity: 0.7; }
          93% { opacity: 0.3; }
          94% { opacity: 0.5; }
          95% { opacity: 0.8; }
          96% { opacity: 0.4; }
          97% { opacity: 0.2; }
          98% { opacity: 0.6; }
          99% { opacity: 0.3; }
        }
        /* --- END OF Crackling Thunder Effect --- */

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .fade-in { animation: fadeIn 0.5s ease-out forwards; }
        .rarity-common { border-color: #6b7280; }
        .rarity-uncommon { border-color: var(--glow-green); box-shadow: 0 0 5px var(--glow-green); }
        .rarity-rare { border-color: var(--glow-blue); box-shadow: 0 0 8px var(--glow-blue); }
        .rarity-instant { border-color: var(--glow-red); box-shadow: 0 0 12px var(--glow-red); animation: pulse 1.5s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
        .form-input { background-color: rgba(23, 23, 33, 0.7); backdrop-filter: blur(5px); border: 1px solid #374151; transition: border-color 0.3s; }
        .form-input:focus { border-color: var(--glow-blue); outline: none; }
        .focus-mode-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.95); backdrop-filter: blur(10px); z-index: 100; display: flex; flex-direction: column; align-items: center; justify-content: center; animation: fadeIn 0.3s ease-out; }
        .start-animation { position: absolute; font-family: 'Orbitron', sans-serif; font-weight: 900; font-size: 15vw; color: white; opacity: 0; animation: start-anim 1.5s ease-in-out forwards; }
        @keyframes start-anim { 0% { opacity: 1; transform: scale(0.5); text-shadow: 0 0 10px #fff; } 50% { opacity: 1; transform: scale(1.2); text-shadow: 0 0 30px var(--glow-blue); } 99% { opacity: 0; transform: scale(2); } 100% { opacity: 0; display: none; } }
        .focus-content { animation: fadeIn 0.5s ease-out 1.5s forwards; opacity: 0; }
        /* Level up overlay styles */
        .level-up-screen {
            position: fixed;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background: radial-gradient(circle at 50% 40%, rgba(0,170,255,0.12), rgba(0,0,0,0.92));
            z-index: 9999;
            pointer-events: none;
            overflow: hidden;
        }
        .level-up-text {
            font-family: 'Orbitron', sans-serif;
            font-weight: 900;
            font-size: 12vw;
            color: #fff;
            text-align: center;
            letter-spacing: 0.06em;
            text-shadow: 0 0 20px rgba(0,170,255,0.9), 0 0 40px rgba(0,170,255,0.6), 0 0 80px rgba(0,170,255,0.35);
            transform: scale(0.6);
            animation: levelTextPop 1.6s ease-out forwards;
        }
        @keyframes levelTextPop {
            0% { opacity: 0; transform: scale(0.4) rotate(-6deg); }
            30% { opacity: 1; transform: scale(1.12) rotate(2deg); }
            60% { transform: scale(0.98) rotate(-1deg); }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }
        .level-up-subtext { margin-top: 0.4rem; font-size: 2.6vw; color: #e6f7ff; opacity: 0.95; }
        /* Solo Leveling SYSTEM notification bar styles */
        .system-notify-container { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 10001; width: min(480px, calc(100% - 2rem)); pointer-events: none; }
    .system-notify { background: transparent; border: 2px solid #00aaff; box-shadow: 0 0 24px rgba(0,170,255,0.5), 0 0 2px rgba(0,170,255,0.8); border-radius: 0.7rem; padding: 0; display: flex; flex-direction: column; transform: scale(0.8); opacity: 0; pointer-events: auto; overflow: hidden; min-width: 320px; }
    .system-divider { width: 80%; height: 2px; background: linear-gradient(90deg, #00aaff 0%, #0a0a0f 100%); border-radius: 2px; margin: 0.3rem 0 0.5rem 0; opacity: 0.7; }
    .system-message-box { background: rgba(20,24,36,0.85); border: 1px solid #00aaff44; border-radius: 0.5rem; padding: 0.5rem 1rem; margin-top: 0.2rem; box-shadow: 0 2px 12px #00aaff22; text-align: center; }
    .system-mission-title { font-family: 'Orbitron', sans-serif; font-weight: 700; font-size: 1.2rem; color: #fff; letter-spacing: 0.04em; margin-bottom: 0.2rem; }
    .system-mission-reward { font-size: 1rem; color: #ffd700; font-family: 'Inter', sans-serif; margin-top: 0.1rem; }
        .system-notify.show { animation: systemSlideDown 0.45s cubic-bezier(.2,.9,.2,1) forwards; }
        .system-notify.hide { animation: systemSlideUp 0.35s ease-in forwards; }
        @keyframes systemSlideDown { 0% { transform: translateY(-140%); opacity: 0; } 100% { transform: translateY(0); opacity: 1; } }
        @keyframes systemSlideUp { 0% { transform: translateY(0); opacity: 1; } 100% { transform: translateY(-120%); opacity: 0; } }
        /* These styles below are now unused, but harmless to keep */
        .system-title {
            font-family: 'Orbitron', sans-serif;
            font-weight: 900;
            font-size: 2.1rem;
            color: #00aaff;
            letter-spacing: 0.09em;
            text-shadow: 0 0 16px #00aaff, 0 0 2px #fff;
            position: relative;
            margin-bottom: 0.1rem;
            animation: glitch 0.7s linear 1;
        }
        @keyframes glitch {
            0% { text-shadow: 0 0 16px #00aaff, 0 0 2px #fff; }
            10% { text-shadow: 2px 0 #00aaff, -2px 0 #fff; }
            20% { text-shadow: -2px 0 #00aaff, 2px 0 #fff; }
            30% { text-shadow: 0 2px #00aaff, 0 -2px #fff; }
            40% { text-shadow: 0 -2px #00aaff, 0 2px #fff; }
            50% { text-shadow: 2px 2px #00aaff, -2px -2px #fff; }
            60% { text-shadow: -2px -2px #00aaff, 2px 2px #fff; }
            70% { text-shadow: 0 0 16px #00aaff, 0 0 2px #fff; }
            100% { text-shadow: 0 0 16px #00aaff, 0 0 2px #fff; }
        }
        .system-desc {
            font-size: 1.1rem;
            color: #e6f7ff;
            font-family: 'Inter', sans-serif;
            text-align: center;
            opacity: 0.98;
            margin-bottom: 0.1rem;
        }
        .system-level {
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            color: #ffd700;
            font-size: 1.2rem;
            margin-top: 0.1rem;
        }
        
    /* --- Styles for SOLO LEVELING NOTIFICATION --- */

    /* The semi-transparent overlay */
    .solo-notification-overlay {
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle at center, rgba(0,0,0,0.85), rgba(0,0,0,0.75)), radial-gradient(circle at 25% 25%, rgba(0,170,255,0.06) 0%, transparent 60%), radial-gradient(circle at 75% 75%, rgba(0,170,255,0.06) 0%, transparent 60%);
      z-index: 10000;
      opacity: 1;
      transition: opacity 0.35s ease-in;
    }

    /* New class to hide body overflow (prevents layout shift) */
    body.no-scroll {
        overflow: hidden; 
    }

    /* Make the overlay fade out with the box */
    .solo-notification-overlay:has(.hide) {
        opacity: 0;
        pointer-events: none; 
    }

    /* New content styles */
    .solo-header {
      font-family: 'Orbitron', sans-serif;
      font-size: 1.1rem;
      font-weight: 700;
      color: #fff;
      border-bottom: 1px solid rgba(0, 170, 255, 0.4);
      padding: 8px 12px;
      text-transform: uppercase;
      letter-spacing: 1px;
      text-shadow: 0 0 5px rgba(0, 170, 255, 0.7);
    }

    .solo-icon {
      border: 1px solid #fff;
      border-radius: 50%;
      padding: 0px 6px;
      margin-right: 10px;
      font-size: 0.9rem;
      font-family: 'Inter', sans-serif;
    }

    /* Toned down text glitch */
    .solo-body {
      font-size: 1.7rem;
      font-weight: 700;
      color: #fff;
      text-align: center;
      padding: 24px 16px 20px;
      font-family: 'Orbitron', sans-serif;
      text-shadow: 0 0 8px rgba(255, 255, 255, 0.7);
      animation: text-glitch 0.3s steps(3, jump-end) infinite;
      position: relative;
    }

    /* New Glitch Effect for the Box */
    .solo-glitch-box {
        position: relative; 
    }

    /* Toned down border glitch */
    .solo-glitch-box::before,
    .solo-glitch-box::after {
      content: '';
      position: absolute;
      top: -2px; 
      left: -2px;
      width: calc(100% + 4px); 
      height: calc(100% + 4px);
      background: transparent;
      border: 2px solid #ff0077;
      box-shadow: 0 0 15px #ff0077, inset 0 0 5px #ff0077;
      animation: glitch-anim 0.5s infinite alternate;
    }

    .solo-glitch-box::after {
      border-color: #00ffea; 
      box-shadow: 0 0 15px #00ffea, inset 0 0 5px #00ffea; 
      animation: glitch-anim 0.4s infinite alternate-reverse;
    }

    /* Toned down keyframes for border */
    @keyframes glitch-anim {
      0% {
        transform: translate(2px, -1px);
        clip-path: polygon(0 10%, 100% 10%, 100% 15%, 0 15%);
      }
      25% {
        transform: translate(-2px, 1px);
        clip-path: polygon(0 40%, 100% 40%, 100% 45%, 0 45%);
      }
      50% {
        transform: translate(1px, -2px);
        clip-path: polygon(0 75%, 100% 75%, 100% 80%, 0 80%);
      }
      75% {
        transform: translate(-1px, 2px);
        clip-path: polygon(0 50%, 100% 50%, 100% 55%, 0 55%);
      }
      100% {
        transform: translate(2px, -1px);
        clip-path: polygon(0 90%, 100% 90%, 100% 95%, 0 95%);
      }
    }

    /* Toned down keyframes for text glitch */
    @keyframes text-glitch {
      0%, 100%, 50% {
        text-shadow: 0 0 8px rgba(255, 255, 255, 0.7);
        transform: translate(0, 0);
      }
      10% {
        text-shadow: 2px 0 #00aaff, -2px 0 #ff0077;
        transform: translate(-1px, 0);
      }
      20% {
        text-shadow: -2px 0 #00aaff, 2px 0 #ff0077;
        transform: translate(1px, 0);
      }
      30% {
        text-shadow: 0 2px #00aaff, 0 -2px #ff0077;
        transform: translate(0, 1px);
      }
      40% {
        text-shadow: 0 -2px #00aaff, 0 2px #ff0077;
        transform: translate(0, -1px);
      }
    }
    /* --- END OF Styles for SOLO LEVELING NOTIFICATION --- */

    /* Shadowy Fog Effect for Titles */
    .title-shadowy-fog {
        color: rgba(169, 169, 169, 0.8);
        text-shadow: 0 0 5px rgba(0,0,0,0.5), 0 0 10px rgba(0,0,0,0.3);
        animation: fog-pulse 2s infinite;
    }
    @keyframes fog-pulse {
        0%, 100% { opacity: 0.8; }
        50% { opacity: 1; }
    }



    </style>
</head>
<body class="animated-bg">
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useRef, createContext, useContext, useCallback } = React;
        const API_URL = 'http://localhost:5001/api';
        const SOCKET_URL = 'http://localhost:5001';
        const api = axios.create({ baseURL: API_URL });
        api.interceptors.request.use(config => { const token = localStorage.getItem('token'); if (token) config.headers['x-auth-token'] = token; return config; }, error => Promise.reject(error));
        const AuthContext = createContext();
    const AuthProvider = ({ children }) => { const [authState, setAuthState] = useState({ token: localStorage.getItem('token'), isAuthenticated: null, loading: true, user: null }); const loadUser = useCallback(async () => { if (localStorage.getItem('token')) { try { const res = await api.get('/auth/me'); setAuthState(prev => ({ ...prev, isAuthenticated: true, user: res.data, loading: false })); } catch (err) { localStorage.removeItem('token'); setAuthState({ token: null, isAuthenticated: false, loading: false, user: null }); } } else { setAuthState({ token: null, isAuthenticated: false, loading: false, user: null }); } }, []); useEffect(() => { loadUser(); }, [loadUser]); const login = async (email, password) => { const res = await api.post('/auth/login', { email, password }); localStorage.setItem('token', res.data.token); await loadUser(); }; const register = async (username, email, password) => { const res = await api.post('/auth/register', { username, email, password }); localStorage.setItem('token', res.data.token); await loadUser(); }; const logout = () => { localStorage.removeItem('token'); setAuthState({ token: null, isAuthenticated: false, loading: false, user: null }); }; return ( <AuthContext.Provider value={{ ...authState, login, register, logout, setUser: (user) => setAuthState(prev => ({...prev, user})) }}> {children} </AuthContext.Provider> ); };
        const useAuth = () => useContext(AuthContext);
        
        // MODIFIED: SystemMessage CSS for positioning
        const SystemMessage = ({ message, type = 'info', onDismiss }) => { 
            if (!message) return null; 
            const styles = { info: 'border-blue-500/50 text-blue-300', success: 'border-green-500/50 text-green-300', error: 'border-red-500/50 text-red-300' }; 
            return ( 
                <div className={`relative mb-4 max-w-sm bg-black/70 backdrop-blur-sm border ${styles[type]} rounded-lg p-4 z-[110] fade-in cursor-pointer`} onClick={onDismiss}> 
                    <p className="font-semibold">{message.title}</p> 
                    <p className="text-sm">{message.body}</p> 
                </div> 
            ); 
        };
        
        const LoadingSpinner = ({ text = "System Initializing..." }) => ( <div className="min-h-screen flex items-center justify-center font-orbitron text-blue-400 text-2xl text-glow-blue"> <svg className="animate-spin -ml-1 mr-3 h-8 w-8 text-blue-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"> <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle> <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path> </svg> {text} </div> );
        const AuthPage = () => { const [isLogin, setIsLogin] = useState(true); const [formData, setFormData] = useState({ username: '', email: '', password: '' }); const [error, setError] = useState(''); const { login, register } = useAuth(); const [loading, setLoading] = useState(false); const onChange = e => setFormData({ ...formData, [e.target.name]: e.target.value }); const onSubmit = async e => { e.preventDefault(); setError(''); setLoading(true); try { if (isLogin) await login(formData.email, formData.password); else await register(formData.username, formData.email, formData.password); } catch (err) { setError(err.response?.data?.msg || 'An unknown error occurred.'); } finally { setLoading(false); } }; return ( <div className="min-h-screen flex items-center justify-center p-4"> <div className="w-full max-w-md bg-black/30 backdrop-blur-lg border border-blue-500/20 rounded-xl p-8 fade-in"> <h1 className="font-orbitron text-4xl text-center text-blue-300 mb-8 text-glow-blue">{isLogin ? 'System Login' : 'Register Hunter'}</h1> {error && <p className="bg-red-900/50 text-red-300 p-3 rounded-md mb-4 text-center border border-red-500/50">{error}</p>} <form onSubmit={onSubmit} className="space-y-6"> {!isLogin && <input type="text" name="username" value={formData.username} onChange={onChange} placeholder="Username" required className="w-full p-3 rounded-md form-input"/>} <input type="email" name="email" value={formData.email} onChange={onChange} placeholder="Email" required className="w-full p-3 rounded-md form-input"/> <input type="password" name="password" value={formData.password} onChange={onChange} placeholder="Password" required minLength="6" className="w-full p-3 rounded-md form-input"/> <button type="submit" disabled={loading} className="w-full font-orbitron text-lg p-3 bg-blue-600 hover:bg-blue-500 disabled:bg-gray-600 rounded-md transition duration-300 glow-blue text-white flex justify-center items-center h-14"> {loading ? <LoadingSpinner text=""/> : isLogin ? 'Log In' : 'Register'} </button> </form> <p className="text-center mt-6 text-gray-400"> <a href="#" onClick={(e) => { e.preventDefault(); setIsLogin(!isLogin); setError('')}} className="hover:text-blue-300 transition-colors"> {isLogin ? 'Need to register an account?' : 'Already have an account?'} </a> </p> </div> </div> ); };
        const CreateMissionForm = ({ onMissionCreated }) => { const [description, setDescription] = useState(''); const [timeLimit, setTimeLimit] = useState(60); const handleSubmit = async (e) => { e.preventDefault(); if (!description.trim()) return; try { const res = await api.post('/missions', { description, timeLimit }); onMissionCreated(res.data); setDescription(''); setTimeLimit(60); } catch (err) { console.error("Failed to create mission:", err); } }; return ( <form onSubmit={handleSubmit} className="bg-black/20 p-4 rounded-lg border border-gray-700/50 space-y-3"> <input type="text" placeholder="Enter new mission description..." value={description} onChange={(e) => setDescription(e.target.value)} className="w-full p-3 rounded-md form-input text-lg" required /> <div className="grid grid-cols-1 sm:grid-cols-2 gap-4 items-center"> <label className="flex flex-col text-sm text-gray-400">Time Limit (Minutes)<input type="number" value={timeLimit} onChange={(e) => setTimeLimit(e.target.value)} className="w-full p-2 rounded-md form-input mt-1" min="1" /></label> <button type="submit" className="w-full font-orbitron p-2 bg-blue-600/80 hover:bg-blue-500/80 rounded-md transition duration-300 glow-blue text-white h-11 self-end">Add Mission</button> </div> </form> ); };
        const MissionTimer = ({ mission, onComplete }) => { const [timeLeft, setTimeLeft] = useState(0); useEffect(() => { if (mission.status !== 'InProgress') return; const calculateTimeLeft = () => { const startTime = new Date(mission.startTime).getTime(); const now = new Date().getTime(); const elapsed = Math.floor((now - startTime) / 1000); return mission.timeLimit - elapsed; }; setTimeLeft(calculateTimeLeft()); const interval = setInterval(() => { const newTimeLeft = calculateTimeLeft(); if (newTimeLeft < 0) { clearInterval(interval); onComplete(mission._id); } setTimeLeft(newTimeLeft); }, 1000); return () => clearInterval(interval); }, [mission]); const formatTime = (seconds) => { if (seconds < 0) seconds = 0; const h = Math.floor(seconds / 3600).toString().padStart(2, '0'); const m = Math.floor((seconds % 3600) / 60).toString().padStart(2, '0'); const s = Math.floor(seconds % 60).toString().padStart(2, '0'); return `${h}:${m}:${s}`; }; return <span className="font-orbitron text-7xl lg:text-9xl text-blue-300">{formatTime(timeLeft)}</span>; };
        const FocusMode = ({ mission, onComplete }) => ( <div className="focus-mode-overlay"> <div className="start-animation">START</div> <div className="focus-content text-center flex flex-col items-center gap-8"> <p className="text-gray-400 font-orbitron">MISSION IN PROGRESS</p> <h1 className="text-4xl lg:text-6xl max-w-4xl">{mission.description}</h1> <div className="my-8"> <MissionTimer mission={mission} onComplete={onComplete} /> </div> <button onClick={() => onComplete(mission._id)} className="font-orbitron text-2xl px-12 py-4 bg-blue-600 hover:bg-blue-500 rounded-lg transition-transform hover:scale-105">Complete Mission</button> </div> </div> );
        
        const QuestsView = ({ missions, onComplete, onStart, onDelete, onMissionCreated }) => { const systemMissions = missions.filter(m => m.source === 'System'); const userMissions = missions.filter(m => m.source === 'User'); return ( <> <div className="mb-8"> <h2 className="font-orbitron text-3xl text-blue-300 mb-4 text-glow-blue">Daily Gates</h2> <div className="space-y-3"> {systemMissions.length === 0 && <p className="text-center text-gray-500 py-4">No gates have opened for today.</p>} {systemMissions.map(m => ( <div key={m._id} onClick={() => m.status === 'Pending' && onComplete(m._id)} className={`p-4 rounded-lg border-l-4 transition-all duration-300 flex items-center justify-between ${m.status === 'Completed' ? 'bg-green-800/20 rarity-common text-gray-500' : `bg-gray-900/50 hover:bg-gray-800/60 cursor-pointer rarity-${m.rarity.toLowerCase()}`}`}> <div className="min-w-0"><p className={`text-lg truncate ${m.status === 'Completed' && 'line-through'}`}>{m.description}</p><p className="text-xs text-gray-400 font-mono">REWARD: {m.expReward} EXP, {m.pointReward} P</p></div> <div className={`w-8 h-8 rounded-full border-2 flex items-center justify-center flex-shrink-0 ml-4 ${m.status === 'Completed' ? 'bg-green-500 border-green-400' : 'border-blue-400'}`}>{m.status === 'Completed' && <svg className="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="3" d="M5 13l4 4L19 7"></path></svg>}</div> </div> ))} </div> </div> <div> <h2 className="font-orbitron text-3xl text-blue-300 mb-4 text-glow-blue">Personal Missions</h2> <CreateMissionForm onMissionCreated={onMissionCreated} /> <div className="space-y-3"> {userMissions.length === 0 && <p className="text-center text-gray-500 py-4">No personal missions assigned. Add one to begin.</p>} {userMissions.map(m => ( <div key={m._id} className={`p-4 rounded-lg border-l-4 flex flex-col sm:flex-row items-center justify-between gap-4 border-gray-700 ${m.status === 'InProgress' && 'border-blue-500 animate-pulse'}`}> <div className="min-w-0 flex-grow"> <p className={`text-lg truncate ${m.status === 'Completed' || m.status === 'Failed' ? 'line-through' : ''}`}>{m.description}</p> {m.status === 'Completed' && <p className="text-xs text-green-400 font-mono">COMPLETED | +{m.expReward} EXP, +{m.pointReward} P</p>} {m.status === 'Failed' && <p className="text-xs text-red-400 font-mono">FAILED | {m.pointReward} P</p>} {m.status === 'Pending' && <p className="text-xs text-gray-400 font-mono">TIME LIMIT: {m.timeLimit / 60} Minutes</p>} </div> <div className="flex items-center gap-2 flex-shrink-0 w-full sm:w-auto"> {m.status === 'Pending' && <> <button onClick={() => onStart(m._id)} className="w-1/2 sm:w-auto font-orbitron px-4 py-2 bg-green-600 hover:bg-green-500 rounded-md transition">Start</button> <button onClick={() => onDelete(m._id)} className="w-1/2 sm:w-auto font-orbitron px-4 py-2 bg-red-800/80 hover:bg-red-700/80 rounded-md transition">Delete</button> </>} {m.status === 'InProgress' && <> <MissionTimer mission={m} onComplete={onComplete} /> <button onClick={() => onComplete(m._id)} className="font-orbitron px-4 py-2 bg-blue-600 hover:bg-blue-500 rounded-md transition">Complete</button> </>} </div> </div> ))} </div> </div> </> ); };
        const LeaderboardView = () => { const [leaderboard, setLeaderboard] = useState([]); useEffect(() => { const fetchLeaderboard = async () => { try { const res = await api.get('/leaderboard/daily'); setLeaderboard(res.data); } catch(err) { console.error("Failed to fetch leaderboard", err) } }; fetchLeaderboard(); }, []); return ( <> <h2 className="font-orbitron text-3xl text-yellow-300 mb-4 glow-gold">Daily Leaderboard</h2> <div className="space-y-2"> {leaderboard.map((player, index) => ( <div key={player._id} className="p-4 rounded-lg bg-black/20 border border-gray-700/50 flex items-center justify-between font-mono"> <div className="flex items-center gap-4"> <span className={`font-orbitron text-2xl w-8 text-center ${index === 0 ? 'text-yellow-300' : index === 1 ? 'text-gray-300' : index === 2 ? 'text-yellow-600' : 'text-blue-400'}`}>{index + 1}</span> <div> <p className="text-lg">{player.username}</p> <p className="text-xs text-gray-500">Level {player.level}</p> </div> </div> <span className="font-orbitron text-xl text-blue-300">{player.dailyScore} P</span> </div> ))} </div> </> ); };
        const ShopView = ({ setSystemMessage }) => {
            const { user, setUser } = useAuth();
            const [shopItems, setShopItems] = useState([]);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                const fetchShopItems = async () => {
                    try {
                        const res = await api.get('/shop');
                        setShopItems(res.data);
                    } catch (err) {
                        console.error('Failed to fetch shop items', err);
                        setSystemMessage({ type: 'error', title: 'Error', body: 'Failed to load shop items.' });
                    } finally {
                        setLoading(false);
                    }
                };
                fetchShopItems();
            }, [setSystemMessage]);

            const handleBuy = async (itemId) => {
                try {
                    const res = await api.post('/shop/buy', { itemId });
                    setUser(res.data.user);
                    setSystemMessage({ type: 'success', title: 'Purchase Successful', body: res.data.msg });
                } catch (err) {
                    setSystemMessage({ type: 'error', title: 'Purchase Failed', body: err.response?.data?.msg || 'An error occurred.' });
                }
            };

            const getRankColor = (rank) => {
                const colors = { E: 'text-gray-400', D: 'text-green-400', C: 'text-blue-400', B: 'text-purple-400', A: 'text-yellow-400', S: 'text-red-400', N: 'text-pink-400' };
                return colors[rank] || 'text-white';
            };

            const handleEquip = async (itemId) => {
                try {
                    const res = await api.post('/shop/equip', { itemId });
                    setUser(res.data.user);
                    setSystemMessage({ type: 'success', title: 'Equipped', body: res.data.msg });
                } catch (err) {
                    setSystemMessage({ type: 'error', title: 'Equip Failed', body: err.response?.data?.msg || 'An error occurred.' });
                }
            };

            const groupedItems = shopItems.reduce((acc, item) => {
                if (!acc[item.rank]) acc[item.rank] = [];
                acc[item.rank].push(item);
                return acc;
            }, {});

            if (loading) return <LoadingSpinner />;

            const rankOrder = ['E', 'D', 'C', 'B', 'A', 'S', 'N'];

            return (
                <div>
                    <h2 className="font-orbitron text-3xl text-red-400 mb-4">Shop</h2>
                    <div className="space-y-6">
                        {Object.keys(groupedItems).sort((a, b) => rankOrder.indexOf(a) - rankOrder.indexOf(b)).map(rank => (
                            <div key={rank}>
                                <h3 className={`font-orbitron text-2xl mb-2 ${getRankColor(rank)}`}>{rank}-Tier Titles</h3>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    {groupedItems[rank].map(item => {
                                        const owned = user.inventory.some(inv => inv.itemId === item.itemId);
                                        const canBuy = !owned && user.level >= item.requiredLevel && user.points >= item.price;
                                        return (
                                            <div key={item.itemId} className="p-4 bg-black/20 rounded-lg border border-gray-700/50">
                                                <h4 className="font-orbitron text-lg text-white">{item.name}</h4>
                                                <p className="text-sm text-gray-400 mb-2">{item.description}</p>
                                                <p className="text-xs text-yellow-300">Price: {item.price} P | Req. Level: {item.requiredLevel}</p>
                                                {owned ? (
                                                    <button
                                                        onClick={() => handleEquip(item.itemId)}
                                                        disabled={user.equippedTitle === item.name}
                                                        className={`mt-2 px-4 py-2 rounded-md font-orbitron text-sm ${user.equippedTitle === item.name ? 'bg-gray-600 cursor-not-allowed' : 'bg-green-600 hover:bg-green-500'}`}
                                                    >
                                                        {user.equippedTitle === item.name ? 'Equipped' : 'Equip'}
                                                    </button>
                                                ) : (
                                                    <button
                                                        onClick={() => handleBuy(item.itemId)}
                                                        disabled={!canBuy}
                                                        className={`mt-2 px-4 py-2 rounded-md font-orbitron text-sm ${canBuy ? 'bg-blue-600 hover:bg-blue-500' : 'bg-gray-600 cursor-not-allowed'}`}
                                                    >
                                                        {canBuy ? 'Buy' : user.level < item.requiredLevel ? 'Level Too Low' : 'Not Enough Points'}
                                                    </button>
                                                )}
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        // Friends management UI
        const FriendsView = ({ setActiveTab, setSelectedFriend }) => {
            const { user, setUser } = useAuth();
            const [friends, setFriends] = useState([]);
            const [newFriendName, setNewFriendName] = useState('');

            const fetchFriends = async () => {
                try {
                    const res = await api.get('/friends');
                    setFriends(res.data);
                } catch (err) { console.error('Failed to fetch friends', err); }
            };

            useEffect(() => { fetchFriends(); }, []);

            const addFriend = async () => {
                if (!newFriendName.trim()) return;
                try {
                    const res = await api.post('/friends', { username: newFriendName });
                    setFriends(prev => [...prev, res.data.friend]);
                    setNewFriendName('');
                } catch (err) { console.error('Add friend failed', err); }
            };

            const removeFriend = async (id) => {
                try {
                    await api.delete(`/friends/${id}`);
                    setFriends(prev => prev.filter(f => f._id !== id));
                } catch (err) { console.error('Remove friend failed', err); }
            };

            const messageFriend = (friend) => {
                setSelectedFriend(friend);
                setActiveTab('chat');
            };

            return (
                <div>
                    <h2 className="font-orbitron text-3xl text-pink-400 mb-4">Friends</h2>
                    <div className="mb-4 flex gap-2">
                        <input className="form-input p-2 rounded-md flex-grow" placeholder="Friend's username" value={newFriendName} onChange={(e) => setNewFriendName(e.target.value)} />
                        <button onClick={addFriend} className="px-4 py-2 bg-blue-600 rounded-md">Add</button>
                    </div>
                    <div className="space-y-2">
                        {friends.map(f => (
                            <div key={f._id} className="p-3 bg-black/20 rounded-md flex justify-between items-center">
                                <div>
                                    <div className="font-orbitron">{f.username}</div>
                                    <div className="text-xs text-gray-400">Level {f.level || 1}</div>
                                </div>
                                <div className="flex gap-2">
                                    <button onClick={() => messageFriend(f)} className="px-3 py-1 bg-green-600 rounded-md">Message</button>
                                    <button onClick={() => removeFriend(f._id)} className="px-3 py-1 bg-red-700 rounded-md">Remove</button>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        const ChatView = ({ selectedFriend, setSelectedFriend }) => {
            const { user } = useAuth();
            const [messages, setMessages] = useState([]);
            const [newMessage, setNewMessage] = useState('');
            const [friends, setFriends] = useState([]);
            const socketRef = useRef();
            const messagesEndRef = useRef(null);
            const scrollToBottom = () => { messagesEndRef.current?.scrollIntoView({ behavior: "smooth" }); };

            const getRankColor = (title) => {
                const titleRanks = {
                    'The Awakened': 'E',
                    'Bearer of the Spark': 'E',
                    'Iron-Willed Challenger': 'D',
                    'The Unwavering': 'D',
                    'Vanguard of Progress': 'C',
                    'Shadow\'s Ascent': 'C',
                    'Breaker of Chains': 'B',
                    'The Relentless': 'B',
                    'Apex Commander': 'A',
                    'Sovereign\'s Gaze': 'A',
                    'Monarch of the Self': 'S',
                    'The Pinnacle': 'S',
                    'Ruler\'s Authority': 'N',
                    'Architect of Your World': 'N'
                };
                const rank = titleRanks[title];
                const colors = { E: 'text-gray-400', D: 'text-green-400', C: 'text-blue-400', B: 'text-purple-400', A: 'text-yellow-400', S: 'text-red-400', N: 'text-pink-400' };
                return colors[rank] || 'text-white';
            };

            useEffect(() => { scrollToBottom(); }, [messages]);

            useEffect(() => {
                socketRef.current = io(SOCKET_URL);
                if (user && user._id) socketRef.current.emit('register', user._id);

                const fetchHistory = async () => {
                    try {
                        const res = await api.get('/chat/history');
                        setMessages(res.data);
                    } catch (err) { console.error("Failed to fetch chat history", err); }
                };

                const fetchFriends = async () => {
                    try {
                        const res = await api.get('/friends');
                        setFriends(res.data);
                    } catch (err) { console.error('Failed to fetch friends', err); }
                };

                fetchHistory();
                fetchFriends();

                socketRef.current.on('newMessage', (message) => {
                    setMessages(prevMessages => [...prevMessages, message]);
                });
                socketRef.current.on('privateMessage', (message) => {
                    setMessages(prev => [...prev, { ...message, private: true }]);
                });

                return () => { socketRef.current.disconnect(); };
            }, [user]);

            const sendMessage = (e) => {
                e.preventDefault();
                if (!newMessage.trim() || !user) return;
                const payload = { userId: user._id, username: user.username, text: newMessage };
                if (selectedFriend) payload.recipientId = selectedFriend._id;
                socketRef.current.emit('sendMessage', payload);
                setNewMessage('');
            };

            return (
                <div className="h-full flex flex-col">
                    <div className="flex items-center justify-between mb-4">
                        <h2 className="font-orbitron text-3xl text-green-400">Guild Chat</h2>
                        <div className="flex items-center gap-2">
                            <select value={selectedFriend?._id || ''} onChange={(e) => setSelectedFriend(friends.find(f => f._id === e.target.value) || null)} className="form-input p-2 rounded-md bg-black/20">
                                <option value="">Global</option>
                                {friends.map(f => <option key={f._id} value={f._id}>{f.username}</option>)}
                            </select>
                            {selectedFriend && <div className="text-sm text-gray-400">Messaging <span className="font-orbitron text-white ml-1">{selectedFriend.username}</span></div>}
                        </div>
                    </div>
                    <div className="flex-grow bg-black/20 p-4 rounded-t-lg border border-gray-700/50 overflow-y-auto">
                        {messages.map((msg, index) => {
                            return (
                                <div key={index} className={`mb-3 ${msg.private ? 'bg-black/25 p-2 rounded' : ''}`}>
                                    <div className="inline-block relative">
                                        <span className="font-bold text-blue-300 relative z-10">
                                            {msg.user.username}
                                        </span>
                                        {msg.user.id && msg.user.id.equippedTitle && (
                                            <span className={`font-bold ${getRankColor(msg.user.id.equippedTitle)}`}> [{msg.user.id.equippedTitle}]</span>
                                        )}
                                        {msg.private && <span className="text-gray-400"> (private)</span>}
                                        <span>:</span>
                                    </div>
                                    <span>{msg.text}</span>
                                </div>
                            );
                        })}
                        <div ref={messagesEndRef} />
                    </div>
                    <form onSubmit={sendMessage} className="flex-shrink-0 flex mt-2">
                        <input type="text" value={newMessage} onChange={(e) => setNewMessage(e.target.value)} placeholder="Type a message..." className="w-full p-3 form-input rounded-b-lg rounded-r-none border-t-0"/>
                        <button type="submit" className="font-orbitron bg-blue-600 hover:bg-blue-500 text-white p-3 rounded-b-lg rounded-l-none">Send</button>
                    </form>
                </div>
            );
        };

        // Solo Leveling SYSTEM notification bar
        const SystemNotifyBar = ({ level = 1, onComplete, isTransition = false, transitionData = null }) => {
            const [visible, setVisible] = useState(false);
            const [phase, setPhase] = useState(isTransition ? 'normal' : 'single');

            useEffect(() => {
                if (phase === 'normal') {
                    document.body.classList.add('no-scroll');
                    setVisible(true);
                    const animationDuration = 350;
                    const t1 = setTimeout(() => setVisible(false), 1800 - animationDuration);
                    const t2 = setTimeout(() => {
                        setVisible(false);
                        setPhase('transition');
                    }, 1800);
                    return () => {
                        clearTimeout(t1);
                        clearTimeout(t2);
                    };
                } else if (phase === 'transition') {
                    setTimeout(() => {
                        document.body.classList.add('no-scroll');
                        setVisible(true);
                        const animationDuration = 350;
                        const t1 = setTimeout(() => setVisible(false), 3000 - animationDuration);
                        const t2 = setTimeout(() => {
                            if (onComplete) onComplete();
                            document.body.classList.remove('no-scroll');
                        }, 3000);
                        return () => {
                            clearTimeout(t1);
                            clearTimeout(t2);
                            document.body.classList.remove('no-scroll');
                        };
                    }, 200);
                } else if (phase === 'single') {
                    document.body.classList.add('no-scroll');
                    setVisible(true);
                    const animationDuration = 350;
                    const t1 = setTimeout(() => setVisible(false), 1800 - animationDuration);
                    const t2 = setTimeout(() => {
                        if (onComplete) onComplete();
                        document.body.classList.remove('no-scroll');
                    }, 1800);
                    return () => {
                        clearTimeout(t1);
                        clearTimeout(t2);
                        document.body.classList.remove('no-scroll');
                    };
                }
            }, [phase, onComplete]);

            const getHeader = () => {
                if (phase === 'transition') {
                    return (
                        <div className="solo-header">
                            <span className="solo-icon">⚠</span>
                            ALERT
                        </div>
                    );
                } else {
                    return (
                        <div className="solo-header">
                            <span className="solo-icon">ⓘ</span>
                            NOTIFICATION
                        </div>
                    );
                }
            };

            const getContent = () => {
                if (phase === 'transition' && transitionData) {
                    return (
                        <>
                            <div className="solo-body" style={{ fontSize: '2.5rem' }}>
                                {transitionData.fromRank} → {transitionData.toRank}
                            </div>
                            <div className="solo-body" style={{ fontSize: '1.5rem', marginTop: '1rem', fontStyle: 'italic' }}>
                                "{transitionData.dialogue}"
                            </div>
                        </>
                    );
                } else {
                    return (
                        <div className="solo-body">
                            Leveled up to level {level}!
                        </div>
                    );
                }
            };

            return (
                <div className="solo-notification-overlay" style={phase === 'transition' ? { background: 'rgba(0,0,0,1)' } : {}}>
                    <div className="system-notify-container">
                        <div className={`system-notify solo-glitch-box ${visible ? 'show' : 'hide'}`} role="status" aria-live="polite">
                            {getHeader()}
                            {getContent()}
                        </div>
                    </div>
                </div>
            );
        };
        
        const Dashboard = () => {
            const { user, logout, setUser } = useAuth();
            const [missions, setMissions] = useState([]);
            const [systemMessage, setSystemMessage] = useState(null);
            const [levelUp, setLevelUp] = useState(false);
            const [activeTab, setActiveTab] = useState('quests');
            const [activeMission, setActiveMission] = useState(null);
            const [selectedFriend, setSelectedFriend] = useState(null);
            const fetchMissions = useCallback(async () => { try { const res = await api.get('/missions/daily'); setMissions(res.data); } catch (err) { console.error("Failed to fetch missions:", err); }}, []);
            useEffect(() => { if(user) fetchMissions(); }, [user, fetchMissions]);

            const handleStartMission = async (id) => { try { const res = await api.put(`/missions/start/${id}`); setActiveMission(res.data); } catch (err) { console.error(err); } };
            const handleCompleteMission = async (id) => { try { const res = await api.put(`/missions/complete/${id}`); setUser(res.data.user); setSystemMessage({ type: res.data.updatedMission.status === 'Failed' ? 'error' : 'success', title: 'Mission Update', body: res.data.msg }); if (res.data.leveledUp) { setLevelUp({ level: res.data.newLevel, isTransition: res.data.isTransition, transitionData: res.data.transitionData }); } setActiveMission(null); fetchMissions(); } catch (err) { console.error(err); setSystemMessage({ type: 'error', title: 'Error', body: err.response?.data?.msg || 'Action failed.' }); } };
            const handleMissionCreated = (newMission) => { setMissions(prev => [...prev, newMission]); };
            const handleDeleteMission = async (id) => { try { await api.delete(`/missions/${id}`); setMissions(prev => prev.filter(m => m._id !== id)); } catch (err) { console.error(err); } };

            const getRank = (level) => {
                if (level >= 101) return 'N';
                if (level >= 86) return 'S';
                if (level >= 61) return 'A';
                if (level >= 46) return 'B';
                if (level >= 31) return 'C';
                if (level >= 16) return 'D';
                return 'E';
            };

            const expPercentage = user ? (user.exp / user.expToNextLevel) * 100 : 0;
            if (!user) return <LoadingSpinner />;
            const TabButton = ({ tabName, children }) => (<button onClick={() => setActiveTab(tabName)} className={`px-4 py-2 font-orbitron rounded-t-lg transition-colors ${activeTab === tabName ? 'bg-black/40 border-b-2 border-blue-400 text-white' : 'text-gray-500 hover:text-white'}`}>{children}</button>);

            if(activeMission) { return <FocusMode mission={activeMission} onComplete={handleCompleteMission} /> }
            
            return (
                <div className="h-screen max-h-screen flex flex-col p-4 sm:p-6 lg:p-8 gap-6 text-gray-200">
                    {/* MODIFIED: Moved SystemMessage inside Status Panel */}
                    <header className={`fade-in border border-blue-500/30 rounded-lg p-4 flex flex-col sm:flex-row justify-between items-center gap-4 transition-all duration-500 flex-shrink-0 ${levelUp ? 'level-up-glow' : ''}`}>
                        <div className="flex items-center gap-4"><div className="flex flex-col items-center"><p className="text-sm text-blue-300">Rank</p><div className="w-16 h-16 rounded-full bg-gray-900 border-2 border-blue-400 flex items-center justify-center text-blue-300 font-orbitron text-4xl">{getRank(user.level)}</div></div><div><h1 className="font-orbitron text-xl sm:text-2xl text-white">{user.username}</h1><p className="text-sm text-yellow-300">🏆 {user.equippedTitle || 'The Weakest Hunter'}</p></div></div>
                        <div className="flex items-center gap-4"><div className="font-orbitron text-center"><p className="text-2xl text-orange-400">{user.streak || 0}</p><p className="text-xs text-gray-400">DAY STREAK</p></div><div className="w-full sm:w-64 flex flex-col gap-2"><div className="flex justify-between items-baseline"><span className="font-orbitron text-lg text-blue-300">LV. {user.level}</span><span className="text-xs text-gray-400 font-mono">EXP: {user.exp} / {user.expToNextLevel}</span></div><div className="w-full bg-gray-900/50 rounded-full h-4 border border-blue-500/30 overflow-hidden"><div className="bg-blue-500 h-full rounded-full transition-all duration-500" style={{ width: `${expPercentage}%` }}></div></div></div></div>
                    </header>
                    <main className="grid grid-cols-1 lg:grid-cols-3 gap-6 flex-grow min-h-0 relative z-10">
                        <div className="lg:col-span-2 flex flex-col min-h-0">
                            <div className="border-b border-gray-700/50 mb-4 flex-shrink-0"><nav className="-mb-px flex gap-4"><TabButton tabName="quests">Quests</TabButton><TabButton tabName="leaderboard">Leaderboard</TabButton><TabButton tabName="shop">Shop</TabButton><TabButton tabName="chat">Chat</TabButton><TabButton tabName="friends">Friends</TabButton></nav></div>
                            <div className="border border-gray-700/50 rounded-lg p-4 sm:p-6 fade-in flex-grow overflow-y-auto">
                                {activeTab === 'quests' && <QuestsView missions={missions} onComplete={handleCompleteMission} onStart={handleStartMission} onDelete={handleDeleteMission} onMissionCreated={handleMissionCreated} />}
                                {activeTab === 'leaderboard' && <LeaderboardView />}
                                {activeTab === 'shop' && <ShopView setSystemMessage={setSystemMessage} />}
                                {activeTab === 'chat' && <ChatView selectedFriend={selectedFriend} setSelectedFriend={setSelectedFriend} />}
                                {activeTab === 'friends' && <FriendsView setActiveTab={setActiveTab} setSelectedFriend={setSelectedFriend} />}
                            </div>
                        </div>
                        <div className="border border-gray-700/50 rounded-lg p-4 sm:p-6 fade-in flex flex-col">
                            <h2 className="font-orbitron text-3xl text-white mb-4">Status</h2>
                            <div className="space-y-4 font-mono text-lg">{user.stats && Object.entries(user.stats).map(([stat, value]) => (<div className="flex justify-between items-center" key={stat}><span className="capitalize">{stat}</span><span className="font-orbitron text-blue-300">{value}</span></div>))}<hr className="border-gray-700 my-4"/><div className="flex justify-between items-center"><span>Points</span><span className="font-orbitron text-yellow-300">{user.points} P</span></div></div>
                            {/* --- MOVED SystemMessage HERE --- */}
                            <SystemMessage message={systemMessage} onDismiss={() => setSystemMessage(null)} /> 
                            {/* --- END MOVE --- */}
                            <button onClick={logout} className="w-full mt-auto font-orbitron p-3 bg-red-800/50 hover:bg-red-700/50 rounded-md transition duration-300 text-white text-lg">Log Out</button>
                        </div>
                    </main>
                    {levelUp && <SystemNotifyBar level={levelUp.level} onComplete={() => setLevelUp(false)} isTransition={levelUp.isTransition} transitionData={levelUp.transitionData} />}
                </div>
            );
        };
        const App = () => { const { isAuthenticated, loading } = useAuth(); if (loading) return <LoadingSpinner />; return isAuthenticated ? <Dashboard /> : <AuthPage />; };
        ReactDOM.createRoot(document.getElementById('root')).render(<AuthProvider><App /></AuthProvider>);
    </script>
</body>
</html>